# ÊúçÂä°Âô®Á´ØÊâãÂä®‰ª£Á†ÅÊõ¥Êñ∞Ê≠•È™§

## ÊñπÊ°àÊ¶ÇËßà

Áî±‰∫é‰Ω†ÊÉ≥Áõ¥Êé•Âú®ÊúçÂä°Âô®ÁéØÂ¢É‰∏≠‰øÆÊîπ‰ª£Á†ÅËÄå‰∏çÈáçÊñ∞ÈÉ®ÁΩ≤ÔºåÊàëÊèê‰æõ‰∫Ü‰∏§‰∏™ÊñπÊ°àÔºö

1. **Ëá™Âä®ÂåñËÑöÊú¨**Ôºö`scripts/server-update.sh` (Êé®Ëçê)
2. **ÊâãÂä®Êìç‰ΩúÊ≠•È™§**Ôºö‰ª•‰∏ãËØ¶ÁªÜÊ≠•È™§

## üöÄ Âø´ÈÄüËá™Âä®Êõ¥Êñ∞ (Êé®Ëçê)

```bash
# Á°Æ‰øùÂÆâË£Ö‰∫Ü sshpass
brew install sshpass  # macOS
# Êàñ
sudo apt-get install sshpass  # Ubuntu

# ËøêË°åËá™Âä®Êõ¥Êñ∞ËÑöÊú¨
./scripts/server-update.sh
```

## üîß ÊâãÂä®Êìç‰ΩúÊ≠•È™§

Â¶ÇÊûú‰Ω†ÊÉ≥‰∫ÜËß£ÂÆåÊï¥ËøáÁ®ãÊàñËá™Âä®ËÑöÊú¨ÈÅáÂà∞ÈóÆÈ¢òÔºåÂèØ‰ª•Êåâ‰ª•‰∏ãÊ≠•È™§ÊâãÂä®Êìç‰ΩúÔºö

### Á¨¨‰∏ÄÊ≠•ÔºöËøûÊé•Âà∞ÊúçÂä°Âô®

```bash
ssh karry@172.31.3.8
```

### Á¨¨‰∫åÊ≠•ÔºöÊ£ÄÊü•ÂΩìÂâçÂÆπÂô®Áä∂ÊÄÅ

```bash
# Êü•ÁúãËøêË°å‰∏≠ÁöÑÂÆπÂô®
sudo docker ps | grep v0.8_neolish

# Êü•ÁúãÂÆπÂô®Êó•Âøó
sudo docker logs v0.8_neolish-container --tail=20
```

### Á¨¨‰∏âÊ≠•ÔºöÂ§á‰ªΩÂéüÂßãÊñá‰ª∂

```bash
# ‰ªéÂÆπÂô®‰∏≠Â§çÂà∂ÂéüÂßãÊñá‰ª∂‰Ωú‰∏∫Â§á‰ªΩ
sudo docker cp v0.8_neolish-container:/app/src/app/[locale]/register/page.tsx /tmp/register-page-backup.tsx
```

### Á¨¨ÂõõÊ≠•ÔºöÂàõÂª∫‰øÆÊîπÂêéÁöÑÊñá‰ª∂

Âú®ÊúçÂä°Âô®‰∏äÂàõÂª∫Êñ∞ÁöÑÊ≥®ÂÜåÈ°µÈù¢Êñá‰ª∂Ôºö

```bash
# ÂàõÂª∫‰øÆÊîπÂêéÁöÑÊñá‰ª∂
cat > /tmp/register-page-new.tsx << 'EOF'
'use client';

import { useState } from 'react';
import { useRouter, useParams } from 'next/navigation';
import Link from 'next/link';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { useTranslations } from 'next-intl';
import { signIn } from 'next-auth/react';

import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
// Label might be implicitly handled by FormLabel, check usage
import { 
  Card, 
  CardContent, 
  CardDescription, 
  CardFooter, 
  CardHeader, 
  CardTitle 
} from "@/components/ui/card";
import { 
  Form, 
  FormControl, 
  FormField, 
  FormItem, 
  FormLabel, 
  FormMessage 
} from "@/components/ui/form";
import { LanguageSwitcher } from "@/components/ui/language-switcher";
import { PasswordInput } from "@/components/ui/password-input";
import { PasswordStrengthIndicator } from "@/components/ui/password-strength-indicator";
import { validatePasswordStrength } from "@/utils/passwordStrength";

export default function RegisterPage() {
  const [apiError, setApiError] = useState<string | null>(null);
  const [successMessage, setSuccessMessage] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [passwordValue, setPasswordValue] = useState('');
  const router = useRouter();
  const params = useParams();
  const locale = params.locale as string;

  // Get translations
  const t = useTranslations('auth.register');
  const tErrors = useTranslations('auth.register.errors');
  const tMessages = useTranslations('auth.messages');

  // Define the validation schema using Zod with internationalized messages and password strength
  const formSchema = z.object({
    email: z.string().email({ message: tErrors('emailFormat') }),
    username: z.string().min(1, { message: tErrors('required') }),
    password: z.string()
      .min(8, { message: tErrors('passwordLength') })
      .refine((password) => {
        const strength = validatePasswordStrength(password);
        return strength.isValid;
      }, {
        message: tErrors('passwordStrengthRequired')
      }),
    confirmPassword: z.string().min(1, { message: tErrors('required') }),
    activationCode: z.string().min(1, { message: tErrors('required') }),
  }).refine((data) => data.password === data.confirmPassword, {
    message: tErrors('passwordMismatch'),
    path: ["confirmPassword"], // ÈîôËØØ‰ø°ÊÅØÊòæÁ§∫Âú®Á°ÆËÆ§ÂØÜÁ†ÅÂ≠óÊÆµ
  });

  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      email: "",
      username: "",
      password: "",
      confirmPassword: "",
      activationCode: "",
    },
  });

  async function onSubmit(values: z.infer<typeof formSchema>) {
    setIsLoading(true);
    setApiError(null);
    setSuccessMessage(null);

    try {
      // Remove confirmPassword from the payload sent to the API
      const { confirmPassword, ...submitValues } = values;
      
      const response = await fetch('/api/auth/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(submitValues),
      });

      const data = await response.json();

      if (!response.ok) {
        let errorMessage = data.error || 'Registration failed. Please try again later.';
        // Check if backend provided specific field errors
        if (data.details) {
          const validFields = ['email', 'username', 'password', 'confirmPassword', 'activationCode'];
          const fieldErrors = Object.entries(data.details)
            .map(([field, errors]) => {
                // Try to set form error for specific field if possible
                if (validFields.includes(field)) {
                    form.setError(field as keyof z.infer<typeof formSchema>, {
                        type: "server",
                        message: (errors as string[]).join(', ')
                    });
                }
                return `${field}: ${(errors as string[]).join(', ')}`;
            })
            .join('; ');
          if (fieldErrors && !errorMessage.includes(fieldErrors)) {
             errorMessage += ` Details: ${fieldErrors}`;
          }
        }
        setApiError(errorMessage);
      } else {
        setSuccessMessage(tMessages('registrationSuccess'));
        form.reset();
        
        // Ê≥®ÂÜåÊàêÂäüÂêéËá™Âä®ÁôªÂΩï
        try {
          const loginResult = await signIn('credentials', {
            email: submitValues.email,
            password: submitValues.password,
            redirect: false, // ÈòªÊ≠¢Ëá™Âä®ÈáçÂÆöÂêëÔºåÊàë‰ª¨ÊâãÂä®ÊéßÂà∂
          });

          if (loginResult?.ok) {
            // ÁôªÂΩïÊàêÂäüÔºåÊ†πÊçÆÊòØÂê¶‰∏∫‰∏áËÉΩÊøÄÊ¥ªÁ†ÅÂÜ≥ÂÆöË∑≥ËΩ¨Ë∑ØÂæÑ
            // Áî±‰∫éÁé∞Âú®Ê≥®ÂÜåÊó∂Â∑≤ÁªèËá™Âä®ÂàõÂª∫Âõ¢ÈòüÔºåÁõ¥Êé•Ë∑≥ËΩ¨Âà∞dashboard
            setTimeout(() => {
              router.push(`/${locale}/dashboard`);
            }, 2000);
          } else {
            // ÁôªÂΩïÂ§±Ë¥•ÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢
            setTimeout(() => {
              router.push(`/${locale}/login`);
            }, 2000);
          }
        } catch (loginError) {
          console.error("Auto-login failed:", loginError);
          // Ëá™Âä®ÁôªÂΩïÂ§±Ë¥•ÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢
          setTimeout(() => {
            router.push(`/${locale}/login`);
          }, 2000);
        }
      }
    } catch (err: any) {
      console.error("Registration submission error:", err);
      setApiError(err.message || 'An unexpected network error occurred. Please try again.');
    } finally {
      setIsLoading(false);
    }
  }

  return (
    <div className="flex min-h-full flex-col items-center justify-center px-4 py-12 relative">
      {/* Language Switcher in top-right corner */}
      <div className="absolute top-4 right-4">
        <LanguageSwitcher />
      </div>
      
      <Card className="w-full max-w-md">
        <CardHeader className="space-y-1 text-center">
          <CardTitle className="text-2xl font-bold">{t('title')}</CardTitle>
          <CardDescription>{t('subtitle')}</CardDescription>
        </CardHeader>
        <CardContent>
          <Form {...form}>
            <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
              <FormField
                control={form.control}
                name="email"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>{t('email')}</FormLabel>
                    <FormControl>
                      <Input placeholder={t('emailPlaceholder')} type="email" autoComplete="email" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
              <FormField
                control={form.control}
                name="username"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>{t('username')}</FormLabel>
                    <FormControl>
                      <Input placeholder={t('usernamePlaceholder')} type="text" autoComplete="username" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
              <FormField
                control={form.control}
                name="password"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>{t('password')}</FormLabel>
                    <FormControl>
                      <PasswordInput 
                        placeholder={t('passwordPlaceholder')} 
                        autoComplete="new-password" 
                        {...field}
                        onChange={(e) => {
                          field.onChange(e);
                          setPasswordValue(e.target.value);
                        }}
                      />
                    </FormControl>
                    <FormMessage />
                    
                    {/* Password Strength Indicator */}
                    <PasswordStrengthIndicator 
                      password={passwordValue}
                      showRequirements={true}
                      className="mt-3"
                    />
                  </FormItem>
                )}
              />
              <FormField
                control={form.control}
                name="confirmPassword"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>{t('confirmPassword')}</FormLabel>
                    <FormControl>
                      <PasswordInput 
                        placeholder={t('confirmPasswordPlaceholder')} 
                        autoComplete="new-password" 
                        {...field} 
                      />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
              <FormField
                control={form.control}
                name="activationCode"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>{t('activationCode')}</FormLabel>
                    <FormControl>
                      <Input placeholder={t('activationCodePlaceholder')} type="text" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              {apiError && (
                <p className="text-sm font-medium text-destructive">{apiError}</p>
              )}
              {successMessage && (
                <p className="text-sm font-medium text-green-600">{successMessage}</p>
              )}

              <Button type="submit" className="w-full" disabled={isLoading}>
                {isLoading ? 'Creating account...' : t('signUpButton')}
              </Button>
            </form>
          </Form>
        </CardContent>
        <CardFooter className="flex flex-col items-center space-y-2">
           <p className="text-center text-sm text-muted-foreground">
             {t('hasAccount')}{' '}
             <Link href={`/${locale}/login`} className="font-semibold text-primary hover:text-primary/90 underline underline-offset-4">
               {t('signInLink')}
             </Link>
           </p>
        </CardFooter>
      </Card>
    </div>
  );
} 
EOF
```

### Á¨¨‰∫îÊ≠•ÔºöÂÅúÊ≠¢ÂÆπÂô®Âπ∂Êõ¥Êñ∞Êñá‰ª∂

```bash
# ÂÅúÊ≠¢ÂÆπÂô®
sudo docker stop v0.8_neolish-container

# Â∞ÜÊñ∞Êñá‰ª∂Â§çÂà∂Âà∞ÂÆπÂô®‰∏≠
sudo docker cp /tmp/register-page-new.tsx v0.8_neolish-container:/app/src/app/[locale]/register/page.tsx
```

### Á¨¨ÂÖ≠Ê≠•ÔºöÈáçÊñ∞ÊûÑÂª∫Âπ∂ÂêØÂä®

```bash
# ÂêØÂä®ÂÆπÂô®
sudo docker start v0.8_neolish-container

# Âú®ÂÆπÂô®ÂÜÖÈáçÊñ∞ÊûÑÂª∫Â∫îÁî®
sudo docker exec -u root v0.8_neolish-container sh -c 'cd /app && npm run build'

# ÈáçÂêØÂÆπÂô®‰ª•Â∫îÁî®Êõ¥Êîπ
sudo docker restart v0.8_neolish-container
```

### Á¨¨‰∏ÉÊ≠•ÔºöÈ™åËØÅÊõ¥Êñ∞

```bash
# Ê£ÄÊü•ÂÆπÂô®Áä∂ÊÄÅ
sudo docker ps | grep v0.8_neolish

# Êü•ÁúãÊúÄÊñ∞Êó•Âøó
sudo docker logs v0.8_neolish-container --tail=20

# Ê∏ÖÁêÜ‰∏¥Êó∂Êñá‰ª∂
rm -f /tmp/register-page-new.tsx
```

### Á¨¨ÂÖ´Ê≠•ÔºöÊµãËØï

ËÆøÈóÆ `http://172.31.3.8:3000` ÊµãËØïÊ≥®ÂÜåÂäüËÉΩÔºö

1. ËøõÂÖ•Ê≥®ÂÜåÈ°µÈù¢
2. Â°´ÂÜôÊ≥®ÂÜå‰ø°ÊÅØ
3. Êèê‰∫§ÂêéÂ∫îËØ•Ôºö
   - Ëá™Âä®ÁôªÂΩïÊàêÂäü
   - Áõ¥Êé•Ë∑≥ËΩ¨Âà∞dashboard
   - ËÄå‰∏çÊòØonboardingÈ°µÈù¢

## üîÑ ÂõûÊªöÊìç‰Ωú (Â¶ÇÊûúÈúÄË¶Å)

Â¶ÇÊûúÊõ¥Êñ∞Âá∫Áé∞ÈóÆÈ¢òÔºåÂèØ‰ª•Âø´ÈÄüÂõûÊªöÔºö

```bash
# ÂÅúÊ≠¢ÂÆπÂô®
sudo docker stop v0.8_neolish-container

# ÊÅ¢Â§çÂ§á‰ªΩÊñá‰ª∂
sudo docker cp /tmp/register-page-backup.tsx v0.8_neolish-container:/app/src/app/[locale]/register/page.tsx

# ÈáçÊñ∞ÊûÑÂª∫Âπ∂ÂêØÂä®
sudo docker start v0.8_neolish-container
sudo docker exec -u root v0.8_neolish-container sh -c 'cd /app && npm run build'
sudo docker restart v0.8_neolish-container
```

## ‚ö†Ô∏è Ê≥®ÊÑè‰∫ãÈ°π

1. **Áîü‰∫ßÁéØÂ¢ÉÊìç‰Ωú**ÔºöËøôÊòØÂú®Áîü‰∫ßÁéØÂ¢ÉÁõ¥Êé•‰øÆÊîπ‰ª£Á†ÅÔºåËØ∑Á°Æ‰øùÊìç‰ΩúÊ≠£Á°Æ
2. **Â§á‰ªΩÈáçË¶Å**ÔºöÂßãÁªàÂÖàÂ§á‰ªΩÂéüÂßãÊñá‰ª∂
3. **ÊûÑÂª∫Êó∂Èó¥**Ôºö`npm run build` ÈúÄË¶ÅÂá†ÂàÜÈíüÊó∂Èó¥ÔºåÊúüÈó¥ÊúçÂä°‰ºöÊöÇÂÅú
4. **ÊµãËØïÈ™åËØÅ**ÔºöÊõ¥Êñ∞ÂÆåÊàêÂêéÂä°ÂøÖÊµãËØïÂäüËÉΩÊòØÂê¶Ê≠£Â∏∏

## üìã Ê†∏ÂøÉÊîπÂä®ËØ¥Êòé

‰∏ªË¶Å‰øÆÊîπÁÇπÔºö
- Ê∑ªÂä†‰∫Ü `import { signIn } from 'next-auth/react';`
- ‰øÆÊîπ‰∫ÜÊ≥®ÂÜåÊàêÂäüÂêéÁöÑÈÄªËæëÔºåÊ∑ªÂä†Ëá™Âä®ÁôªÂΩïÂäüËÉΩ
- ÁßªÈô§‰∫ÜË∑≥ËΩ¨Âà∞onboardingÁöÑÈÄªËæëÔºåÁªü‰∏ÄË∑≥ËΩ¨Âà∞dashboard
- ‰øùÊåÅ‰∫ÜÈîôËØØÂ§ÑÁêÜÂíåÁî®Êà∑‰ΩìÈ™åÁöÑËøûÁª≠ÊÄß 